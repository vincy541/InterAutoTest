{"name": "test_complete_booking", "status": "broken", "statusDetails": {"message": "TypeError: string indices must be integers", "trace": "def test_complete_booking():\n        # 1、初始化数据库对象\n        conn = init_db(\"db_1\")\n        # 2、查询结果\n        res_db = conn.fetchone(\n            \"select * from shipping_voucher where shipping_document_id  ='52XSeTmQLUC' and type='Booking'\")\n        print(\"数据库查询结果，订舱委托id：\", res_db['id'])\n    \n        # 一、完成「订舱委托」任务\n        booking_url = base_url + \"/shipping_written_material/booking/\" + res_db['id'] + \"?provide_from_order_hub=true\"\n        # 1.读取yaml文件\n        filling_data = YamlReader(\"../../data/filling_booking.yml\").data()\n        # 获取sid\n        cookie = {\n            \"sid\": common.get_sid()\n        }\n        request = Request()\n        r = request.post(booking_url, json=filling_data, cookies=cookie)\n        # print(r)\n        # AssertUtil().assert_code(r[\"code\"], 200)\n    \n        # 判断「订舱委托」任务是否已完成\n        # 1.获取「订舱」执行单id，传入货运单ID\n        select_id = {\n            \"groupId\": \"52XSeTmQLUC\"\n        }\n        ticket_details = common.ticket_details(select_id)\n        # print(ticket_details.json())\n        booking_ticket_type = '0604001'\n        # 遍历结果\n        for voucher_ticket in ticket_details.json()['content']['ticketDetails']:\n            if voucher_ticket['ticket']['type'] == booking_ticket_type:\n                # 找到匹配的执行单，获取执行单id\n                booking_ticket_id = voucher_ticket['ticket']['id']\n                # print(\"订舱委托执行单id：\", booking_ticket_id)\n    \n                # 找到当前执行单下的「订舱委托」任务，校验任务为已完成\n                select_id = {\n                    \"ticketIds\": [f\"{booking_ticket_id}\"]\n                }\n                task_details = common.task_detail(select_id)\n                # 订舱委托任务type=0604001001\n                booking_task_type = '0604001001'\n                for ticket_details in task_details.json()['content']['taskDetails']:\n                    if ticket_details['task']['type'] == booking_task_type:\n                        # 匹配「订舱委托」任务，获取任务状态\n                        booking_task_status = ticket_details['task']['status']\n                        print(\"「订舱信息」任务状态为：\", booking_task_status)\n                        # assert booking_task_status == 6\n                        if AssertUtil.assert_body(booking_task_status, booking_task_status, 6):\n                            print(\"成功完成【订舱委托】任务\")\n                            break\n                        else:\n                            # 如果没有找到匹配的任务\n                            print(\"「订舱委托」任务，未完成\")\n    \n                # booking发送货代任务type=0604001002\n                booking_send_task_type = '0604001002'\n                for ticket_details in task_details.json()['content']['taskDetails']:\n                    if ticket_details['task']['type'] == booking_send_task_type:\n                        # 匹配「booking发送货代」任务，获取任务uid和id\n                        booking_send_task_id = ticket_details['task']['id']\n                        booking_send_task_uid = ticket_details['task']['uid']\n                        print(\"「booking发送货代」任务id：\", booking_send_task_id)\n                        print(\"「booking发送货代」任务uid：\", booking_send_task_uid)\n    \n                        # 二、完成「booking发送货代」任务\n                        booking_send_url = f\"{base_url}/order_hub/save_task_content\"\n                        booking_send_data = {\n                            \"data\": \"{}\",\n                            \"taskUid\": booking_send_task_uid,\n                            \"taskId\": booking_send_task_id\n                        }\n                        request = Request()\n                        r = request.post(booking_send_url, json=booking_send_data, cookies=cookie)\n                        # print(r)\n                        # 验证「booking发送货代」任务完成\n                        booking_send_task_status = ticket_details['task']['status']\n                        print(\"「booking发送货代」任务状态为：\", booking_send_task_status)\n                        # assert booking_send_task_status == 6\n                        if AssertUtil.assert_body(booking_send_task_status, booking_send_task_status, 6):\n                            print(\"成功完成「booking发送货代」任务\")\n                        else:\n                            # 如果没有找到匹配的任务\n                            print(\"「booking发送货代」任务，未完成\")\n    \n        # 三、完成「货代放舱/SO上传」任务\n        # 查询数据库，获取货代放舱任务的id\n        db_forwarder_id = conn.fetchone(\n            \"select * from shipping_voucher where shipping_document_id  ='52XSeTmQLUC' and type='ShippingOrder'\")\n        print(\"数据库查询结果，货代放舱id：\", db_forwarder_id['id'])\n    \n        # 获取url\n        forwarder_url = base_url + \"/shipping_written_material/forwarder/\" + db_forwarder_id['id'] + \"?provide_from_order_hub=true\"\n        # 获取请求参数\n        forwarder_data = YamlReader(\"../../data/voucher/filling_forwarder.yml\").data()\n        request = Request()\n        r = request.post(forwarder_url, json=forwarder_data, cookies=cookie)\n        print(r)\n        # AssertUtil().assert_code(r[\"code\"], 200)\n        # 判断货代放仓任务是否完成\n        # 货代放仓任务type = 0604001003\n        # forwarder_task_type = '0604001003'\n        # 传入请求参数\n        select_id = {\n            \"groupId\": \"52XSeTmQLUC\"\n        }\n        ticket_type = '0604001'\n        task_type = '0604001003'\n>       rr = common.task_status(select_id, ticket_type, task_type)\n\ntest_voucher.py:120: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ngroupId = {'groupId': '52XSeTmQLUC'}, ticket_type = '0604001', task_type = '0604001003'\n\n    def task_status(groupId, ticket_type, task_type):\n        ticket_url = f'{base_url}/auth/task_hub/ticket/list'\n        cookie = {\n            \"sid\": get_sid()\n        }\n        ticket_detailss = requests.post(url=ticket_url, json=groupId, cookies=cookie)\n        current_ticket_type = ticket_type\n        # 遍历结果\n>       for ticket in ticket_detailss.json()['content']['ticketDetails']:\nE       TypeError: string indices must be integers\n\n../../common/common.py:58: TypeError"}, "attachments": [{"name": "log", "source": "b13e8316-9510-4286-914d-c0ef828a5db1-attachment.txt", "type": "text/plain"}], "start": 1703160182310, "stop": 1703160185042, "uuid": "1113080e-ae77-4dbb-8ed8-e8b6ad594cb5", "historyId": "66a18088793d7fd43ee8f9e98cd662f1", "testCaseId": "66a18088793d7fd43ee8f9e98cd662f1", "fullName": "testcase.voucher.test_voucher#test_complete_booking", "labels": [{"name": "parentSuite", "value": "testcase.voucher"}, {"name": "suite", "value": "test_voucher"}, {"name": "host", "value": "lifaliangdeAir.lan"}, {"name": "thread", "value": "33433-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testcase.voucher.test_voucher"}]}